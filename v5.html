<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ðŸš„ Mini Railway Mesh</title>

<style>
body{
  font-family: system-ui, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  margin:0;
  padding:20px;
}
h3{margin-bottom:10px}
#status{
  padding:8px;
  background:#1e293b;
  border-radius:6px;
  margin-bottom:10px;
}
#chat{
  background:#020617;
  border-radius:8px;
  padding:10px;
  height:260px;
  overflow:auto;
  font-size:14px;
}
.me{color:#38bdf8}
.other{color:#a5b4fc}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  font-size:16px;
  border-radius:8px;
  border:none;
}
input{background:#020617;color:#e5e7eb}
button{
  background:#2563eb;
  color:white;
}
button:disabled{
  background:#475569;
}
</style>
</head>

<body>

<h3>ðŸš„ Mini Railway Mesh</h3>

<div id="status">ðŸ”„ Connectingâ€¦</div>

<div id="chat"></div>

<input id="msg" placeholder="Tulis pesanâ€¦">
<button id="sendBtn" disabled>Kirim</button>

<script>
/* ================= CONFIG ================= */
const WS_URL = "ws://192.168.1.10:8080"; // GANTI JIKA PERLU
const myId = Math.random().toString(36).slice(2,7);

/* ================= UI ================= */
const statusEl = document.getElementById("status");
const chatEl = document.getElementById("chat");
const msgEl = document.getElementById("msg");
const sendBtn = document.getElementById("sendBtn");

function log(text, cls){
  const d = document.createElement("div");
  d.textContent = text;
  d.className = cls;
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
}

/* ================= WS ================= */
let ws;
let retry = 0;

function connect(){
  ws = new WebSocket(WS_URL);

  ws.onopen = () => {
    retry = 0;
    statusEl.textContent = "ðŸŸ¢ Connected";
    sendBtn.disabled = false;
  };

  ws.onmessage = e => {
    const o = JSON.parse(e.data);
    if(o.from === myId) return;
    log(o.text, "other");
  };

  ws.onerror = () => {
    ws.close();
  };

  ws.onclose = () => {
    sendBtn.disabled = true;
    statusEl.textContent = "ðŸ”´ Disconnected â€” reconnectingâ€¦";
    retry++;
    setTimeout(connect, Math.min(3000 * retry, 10000));
  };
}

connect();

/* ================= SEND ================= */
sendBtn.onclick = () => {
  const text = msgEl.value.trim();
  if(!text || ws.readyState !== 1) return;

  const payload = { from: myId, text };
  ws.send(JSON.stringify(payload));
  log("me: " + text, "me");
  msgEl.value = "";
};
</script>

</body>
</html>