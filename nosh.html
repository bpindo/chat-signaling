<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Nostr Relay FIX â€“ Realtime Signaling</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  background:#0f0f0f;
  color:#eaeaea;
  font-family:system-ui,sans-serif;
  padding:10px;
}
h3 { margin-bottom:6px }
#log {
  background:#000;
  height:60vh;
  overflow:auto;
  padding:8px;
  border-radius:6px;
  font-size:13px;
}
input, textarea, button {
  width:100%;
  margin-top:6px;
  padding:8px;
  border:none;
  border-radius:4px;
  font-size:14px;
}
button {
  background:#00ff9c;
  color:#000;
  font-weight:bold;
}
</style>
</head>

<body>

<h3>ðŸ”— Nostr Relay â€“ FIX (Ephemeral)</h3>

<div id="log"></div>

<input id="room" value="mesh-123" placeholder="Room ID">
<textarea id="payload" rows="4"
placeholder='Contoh:
{"type":"offer","from":"A"}'></textarea>

<button onclick="sendEvent()">KIRIM EVENT</button>

<script>
/* =========================
   KONFIG
========================= */
const RELAY = "wss://relay.damus.io";
const KIND = 20001; // EPHEMERAL (NO SIGN)

/* =========================
   UTIL LOG
========================= */
function log(msg){
  const el = document.getElementById("log");
  el.innerHTML += msg + "<br>";
  el.scrollTop = el.scrollHeight;
}

/* =========================
   CONNECT
========================= */
const ws = new WebSocket(RELAY);

ws.onopen = () => {
  log("âœ… Connected to relay");
  subscribe();
};

ws.onclose = () => log("âŒ Disconnected");
ws.onerror = () => log("âš ï¸ Error relay");

ws.onmessage = (e) => {
  const data = JSON.parse(e.data);
  if (data[0] === "EVENT") {
    const ev = data[2];
    log("ðŸ“¥ " + ev.content);
  }
};

/* =========================
   SUBSCRIBE
========================= */
function subscribe(){
  const room = document.getElementById("room").value;
  ws.send(JSON.stringify([
    "REQ",
    "sub-" + room,
    {
      kinds:[KIND],
      "#room":[room]
    }
  ]));
  log("ðŸ“¡ Subscribe room: " + room);
}

/* =========================
   SEND EVENT
========================= */
function sendEvent(){
  const room = document.getElementById("room").value;
  const content = document.getElementById("payload").value;

  if(!content) return alert("Payload kosong");

  const event = {
    pubkey: "anon",
    created_at: Math.floor(Date.now()/1000),
    kind: KIND,
    tags: [
      ["room", room]
    ],
    content: content
  };

  ws.send(JSON.stringify(["EVENT", event]));
  log("ðŸ“¤ " + content);
}
</script>

</body>
</html>